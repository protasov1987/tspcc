# Трекер маршрутных карт ТСЗП

Локальное веб-приложение для управления технологическими картами, маршрутами операций и трекингом выполнения. Все данные хранятся на сервере в файле-базе `data/database.json`, поэтому ими могут пользоваться несколько пользователей из разных браузеров и устройств, подключённых к одному экземпляру приложения.

## Структура
- `index.html` — основной каркас страницы и разметка.
- `style.css` — стили оформления.
- `app.js` — функциональность приложения, работа с серверным API и генерацией EAN-13.
- `server.js` — лёгкий сервер на встроенных модулях Node.js, отдающий статику и JSON API.
- `db.js` — простой файловый "движок" базы данных (очередь на запись, нормализация данных).
- `data/database.json` — файл-база, где сервер хранит текущее состояние карт, операций и участков.

## Установка и запуск локально
1. Убедитесь, что установлен Node.js 18+.
2. Дополнительные зависимости не требуются — используются только встроенные модули Node.js.
3. Запустите сервер:
   ```bash
   npm start
   ```
4. Откройте в браузере `http://localhost:8000/`.

Данные создаются автоматически при первом запуске и сохраняются в `data/database.json`. Чтобы перенести состояние на другой сервер, скопируйте этот файл.

Если сервер не запущен или недоступен, вверху страницы появится предупреждение — в этом режиме данные остаются только в текущей сессии браузера.

## Доступ из сети
- Для доступа с других устройств запустите сервер, привязав его к `0.0.0.0`:
  ```bash
  HOST=0.0.0.0 PORT=8000 npm start
  ```
- Определите IP машины и откройте `http://IP_АДРЕСА:8000/` на нужном устройстве.

## Трекер и архив
- На вкладке «Трекер» доступен поиск по номеру карты, названию, заказу и фильтр по статусам («Не запущена», «Выполняется», «Пауза», «Смешанно», «Выполнено»).
- Каждая карта отображает статусную плашку рядом с кнопкой штрихкода. Завершённые карты можно перенести в архив кнопкой «Перенести в архив».
- Во время выполнения операций можно добавлять комментарии в столбце «Комментарии»; для завершённых операций поле блокируется.
- Архив доступен на отдельной вкладке с собственным поиском и фильтром по статусу. Карты в архиве доступны только для просмотра, но их можно «Повторить» — создаётся копия со свежим номером EAN-13, статусом «Не запущена» и сброшенными таймерами.
- Дашборд показывает только незавершённые карты, по которым уже были действия, с прогрессом по операциям и последними комментариями.
- В карточках и квитанциях видно дополнительные реквизиты карт (количество изделий, чертёж/обозначение, материал, описание) прямо над таблицами операций; эти же данные попадают в историю изменений и печатные формы.

## Файлы технологических карт
- У каждой карты можно хранить вложения (pdf, doc/docx, jpg/png или архивы zip/rar/7z) с помощью кнопки со скрепкой в карточках, маршрутных квитанциях и архиве.
- Вложения добавляются через отдельное окно: его можно открыть из модального редактора карты или по клику на скрепку в списках. Внутри доступны просмотр списка и скачивание; добавление недоступно только если сервер не отвечает.
- Максимальный размер одного файла — 15 МБ. Счётчик рядом со скрепкой показывает количество прикреплённых файлов.

## История изменений и сводные таблицы
- Кнопка **Log** рядом со скрепкой (во вкладках «Трекер» и «Архив») открывает окно «История изменений маршрутной карты».
- В окне показываются штрихкод и реквизиты карты, состояние при создании, полная таблица изменений (когда менялись поля, операции, статусы, исполнители, файлы) и сводная таблица операций в том же порядке столбцов, что и во вкладке квитанций.
- В каждой сводной таблице видна цепочка смен исполнителей по операции (например, «Иванов → Петров»), фактическое время и актуальные комментарии.
- Кнопка «Печать сводной таблицы» формирует лист A4 в альбомной ориентации с названием карты, штрихкодом, номером заказа и текущей сводной таблицей.

## Развертывание
Приложение работает как статический сайт с небольшим API для хранения данных. Его можно развернуть:
- На любом сервере/контейнере с Node.js, запустив `npm start`.
- В Docker-контейнере (базовый образ `node:18-alpine`, копируйте файлы, установите зависимости, опубликуйте порт `8000`).

## Решение конфликтов при слиянии
Если GitHub сообщает о конфликтах этой ветки, обновите её относительно `main` (merge/rebase), вручную разрешите маркеры `<<<<<<<`, `=======`, `>>>>>>>` в конфликтующих файлах и сделайте коммит с результатом. После этого PR можно слить.
